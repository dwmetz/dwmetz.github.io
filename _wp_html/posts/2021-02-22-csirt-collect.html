<!-- wp:paragraph -->
<p><strong>A PowerShell script to collect memory and (triage) disk forensics for incident response investigations</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>There's a number of tools that support a one-to-many remote operation capability. However, not all organizations have that level of capability. I've also seen that in some large organizations how things are designed to work with remote assets, and how they actually work, may not be the same. What I wanted was a repeatable pre-defined collection mechanism, that could scale out to be supported by non-forensics team members to participate in forensic evidence collection for incident response examinations. The intent is that the collection process can be distributed among remote team members, be it site support or Security Operations Center (SOC). The script can also be integrated into SOAR and EDR platforms.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>CSIRT-Collect was written to fill that role.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>https://github.com/dwmetz/CSIRT-Collect</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":411,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="https://bakerstreetforensics.com/wp-content/uploads/2021/02/picture1.png?w=1024" alt="" class="wp-image-411" /></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p><strong>CSIRT-Collect leverages a network share, from which it will access and copy the required executables and subsequently upload the acquired evidence to the same share post-collection.</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Permission requirements for said directory will be dependent on the nuances of the environment and what credentials are used for the script execution (interactive vs. automation).  In the demonstration code, a network location of \\Synology\Collections can be seen. This should be changed to reflect the specifics of your environment.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>The Collections folder will need to include:<br>- subdirectory KAPE; copy the directory from any existing install<br>- subdirectory MEMORY; 7za.exe command line version of 7zip and winpmem.exe</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>CSIRT-Collect Operations:</h2>
<!-- /wp:heading -->

<!-- wp:list -->
<ul><li>Maps to existing network drive -</li><li>Subdir 1: “Memory” – Winpmem and 7zip executables</li><li>Subdir 2: ”KAPE” – directory (copied from local install)</li><li>Creates a local directory on asset</li><li>Copies the Memory exe files to local directory</li><li>Captures memory with Winpmem</li><li>When complete, ZIPs the memory image</li><li>Renames the zip file based on hostname</li><li>Documents the OS Build Info (no need to determine profile for Volatility)</li><li>Compressed image is copied to network directory and deleted from host after transfer complete</li><li>New temp Directory on asset for KAPE output</li><li>KAPE !SANS_Triage collection is run using VHDX as output format [$hostname.vhdx] **</li><li>VHDX transfers to network</li><li>Removes the local KAPE directory after completion</li><li>Writes a “Process complete” text file to network to signal investigators that collection is ready for analysis.</li></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p><em>** Note: you can build different KAPE collection profiles by modifying just one line of code. Profiles can be chosen to support the requirements of the investigation.</em></p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>CSIRT-Collect_USB</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>This is a separate script that performs essentially the same functionality as CSIRT-Collect.ps1 with the exception that it is intended to be run from a USB device. There is no need for a temporary host directory as the information is written direct to the USB device. The extra compression operations on the memory image and KAPE .vhdx have also been omitted. There is a slight change noted below to the folder structure for the USB version. On the root of the USB:</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul><li>CSIRT-Collect_USB.ps1</li><li>folder (empty to start) titled 'Collections'</li><li>folders for KAPE and Memory - same as above</li><li>Execution: -Open PowerShell as Adminstrator -Navigate to the USB device -Execute ./CSIRT-Collect_USB.ps1</li></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>To see a demonstration of CSIRT-Collect in action please register for my talk this Thursday, <strong>PowerShell Tools for IR Forensics Collection</strong> as part of the <a href="https://magnetforensics.swoogo.com/enterprise-pulse" target="_blank" rel="noreferrer noopener">Enterprise Pulse</a> lecture series hosted by Magnet Forensics. </p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":413,"sizeSlug":"large","linkDestination":"custom"} -->
<figure class="wp-block-image size-large"><a href="https://magnetforensics.swoogo.com/enterprise-pulse"><img src="https://bakerstreetforensics.com/wp-content/uploads/2021/02/enterprise-pulse.png?w=1024" alt="" class="wp-image-413" /></a></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>Q&amp;A will be live on <a rel="noreferrer noopener" href="https://discord.gg/fMkHuYybSb" target="_blank">Discord</a> during the event.</p>
<!-- /wp:paragraph -->