<!-- wp:heading -->
<h2 class="wp-block-heading">Rogue Inbox</h2>
<!-- /wp:heading -->

<!-- wp:image {"id":1741,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-16-at-12.10.40e280afpm.png?w=1024" alt="" class="wp-image-1741" /></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>Originally I was looking at this in Timeline Explorer, but decided to switch to Excel. </p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Swimming and scanning through a sea of log entries, an anomaly showed itself.</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":1743,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-16-at-3.09.42e280afpm.png?w=1024" alt="" class="wp-image-1743" /></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>For this one I just copied the values out by hand.</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":1747,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-17-at-2.18.56e280afpm.png?w=739" alt="" class="wp-image-1747" /></figure>
<!-- /wp:image -->

<!-- wp:separator -->
<hr class="wp-block-separator has-alpha-channel-opacity" />
<!-- /wp:separator -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Huntress CTF: Week 3 - Forensics: Rogue Inbox, Texas Chainsaw Massacre: Tokyo Drift</h2>
<!-- /wp:heading -->

<!-- wp:image {"id":1903,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-21-at-1.05.12e280afpm.png?w=1024" alt="" class="wp-image-1903" /></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>The download is Application Logs.evtx</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>If you open the log with Event Viewer, you may see there's an entry for a (non-actual) event ID of 1337.</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":1905,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-27-at-8.27.33e280afam.png?w=1024" alt="" class="wp-image-1905" /></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>The error content isn't very helpful.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Let's take a hint from the title and run the event log through <strong>Chainsaw</strong>.</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":1908,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-27-at-8.52.20e280afam.png?w=1024" alt="" class="wp-image-1908" /></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>Nothing significant when using the stock rules. What if we poke specifically at Event ID 1337.</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":1910,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-27-at-8.53.11e280afam.png?w=1024" alt="" class="wp-image-1910" /></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>That looks interesting.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Copy the binary data and bring it over to CyberChef</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":1912,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-27-at-8.54.04e280afam.png?w=1024" alt="" class="wp-image-1912" /></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>From unintelligible binary to unintelligible PowerShell.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Copy the output and save it is a .ps1 file.  We can run the script through PowerDecode.</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":1914,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-27-at-2.50.01e280afpm.png?w=1024" alt="" class="wp-image-1914" /></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>PowerCode works down through the obfuscation layers, finally revealing the plain text of the command.</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":1916,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-27-at-2.51.32e280afpm.png?w=1024" alt="" class="wp-image-1916" /></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>Now that the code has been deobfuscated, time to figure out what it does. I copied the code into PowerShell ISE and start isolating the different command sections.</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":1918,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-27-at-2.54.06e280afpm.png?w=1024" alt="" class="wp-image-1918" /></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>One of the commands does a DNS lookup and directs the output into a string.</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":1921,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-27-at-4.16.58e280afpm.png?w=1024" alt="" class="wp-image-1921" /></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>If we run the command on its own we can see the output.  The last part of the script checks to see if the output matches the pattern of a Base64 encoded string, and if so, decodes it.</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":1922,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-27-at-2.55.09e280afpm.png?w=1024" alt="" class="wp-image-1922" /></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>Now what was that about Tokyo?</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":1924,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/tcm.jpg?w=1024" alt="" class="wp-image-1924" /></figure>
<!-- /wp:image -->

<!-- wp:separator -->
<hr class="wp-block-separator has-alpha-channel-opacity" />
<!-- /wp:separator -->

<!-- wp:paragraph -->
<p>Use the tag <a href="https://bakerstreetforensics.com/tag/HuntressCTF/"><strong>#HuntressCTF</strong></a> on BakerStreetForensics.com to see all related posts and solutions for the 2023 Huntress CTF.</p>
<!-- /wp:paragraph -->