<!-- wp:heading -->
<h2 class="wp-block-heading">Hot Off The Press</h2>
<!-- /wp:heading -->

<!-- wp:image {"id":1500,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-09-at-12.46.34e280afpm.png?w=1024" alt="" class="wp-image-1500" /></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>To start with let's see what kind of file this is.</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":1502,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-09-at-12.48.33e280afpm.png?w=995" alt="" class="wp-image-1502" /></figure>
<!-- /wp:image -->

<!-- wp:quote -->
<blockquote class="wp-block-quote"><!-- wp:paragraph -->
<p>"<strong>UHARC</strong>&nbsp;is a compression/archiving system for PC platforms, which appears to be neglected since around 2005. It achieves better compression than most other archivers, at the expense of being much slower."&nbsp;</p>
<!-- /wp:paragraph --><cite>http://fileformats.archiveteam.org/wiki/UHARC</cite></blockquote>
<!-- /wp:quote -->

<!-- wp:paragraph -->
<p>I scoured the internet looking for a copy of UHARC to download. I'm not going to link any here as many if not all may contain malware. Since this is a Windows only tool, (or Wine under Linux), we'll open this one in a sandboxed Windows system.</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":1505,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-09-at-12.55.17e280afpm.png?w=716" alt="" class="wp-image-1505" /></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>When the file extracts we are presented with hot_off_the_press.ps1.</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":1507,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-05-at-11.00.48e280afam.png?w=1024" alt="" class="wp-image-1507" /></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>OMG that's a lot of obfuscation! Let's see if we can clean this up and make it more readable.  First let's remove all the ''+''</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":1509,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-05-at-11.02.44e280afam.png?w=1024" alt="" class="wp-image-1509" /></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>That's a little bit better. There's another obfuscation method going on where specific numbers are used to represent different letters. Originally, I tried to determine the substitution by completing terms I knew. Early ahead I saw (''Sc{2}i'pt{1}loc{0}Logging'') which to me reads like ScriptBlockLogging. So all 2's are i's, 1's are B's, and 0's are k.  I do a find/replace through the script with replacements on {0},{1}, and {2}. Now it looks like a block of Base64 in the middle block. I copy it over to CyberChef and ... NADA. Something's not right.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>If you look closer at the code, you'll see that each one of the strings that had a {#} substitution in it ends with "-f" followed by other letters in quotations. The first character after -f is substituted for {0}, the next for {1}, etc.  So I run the same substitution pattern on the script using the correct letters for this string this time. </p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Replace the {0} with L.</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":1511,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-05-at-11.05.52e280afam.png?w=1024" alt="" class="wp-image-1511" /></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>Replace the {1} with E.</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":1512,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-05-at-11.06.25e280afam.png?w=1024" alt="" class="wp-image-1512" /></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>Now we've got a nice clean block of Base64.</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":1514,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-05-at-11.08.03e280afam.png?w=1024" alt="" class="wp-image-1514" /></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>Bring that over to CyberChef for decoding and:</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":1516,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-05-at-11.09.22e280afam.png?w=1024" alt="" class="wp-image-1516" /></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>We've got a script within the script.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>If you scroll down in the output, you'll see that there's something else encoded as well.</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":1518,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-05-at-11.10.07e280afam.png?w=939" alt="" class="wp-image-1518" /></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>We'll run that through CyberChef.</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":1520,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-05-at-11.10.55e280afam.png?w=1024" alt="" class="wp-image-1520" /></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>Interesting we have an encoded_flag.  Let's add URL decode to the recipe.</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":1523,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-05-at-11.11.25e280afam.png?w=1024" alt="" class="wp-image-1523" /></figure>
<!-- /wp:image -->

<!-- wp:separator -->
<hr class="wp-block-separator has-alpha-channel-opacity" />
<!-- /wp:separator -->

<!-- wp:heading -->
<h2 class="wp-block-heading">HumanTwo</h2>
<!-- /wp:heading -->

<!-- wp:image {"id":1525,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-05-at-11.21.25e280afam.png?w=1024" alt="" class="wp-image-1525" /></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>There were 1,000 files in the zip container.  Easy comparison options like file size, modification date etc. don't help as they are the same for all the files. It's something in the content that has to be different. How the 'f' am I going to find the outlier in 1,000 files?! <a href="https://meldmerge.org">Meld</a> and diff are two options coming up in the Discord. I install Meld, which is really a gui for diff, and start getting a feel for it. You can compare files or directories. If doing files you could do a 3 way comparison between 3 files. But not 1000.  As I was looking through the files with Meld it struck me that all of the file contents we also the same with the exception of one line.</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":1528,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-09-at-1.34.18e280afpm.png?w=1024" alt="" class="wp-image-1528" /></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>Let's run through all the files with the_silver_searcher and isolate on <strong>String.Equals</strong></p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":1529,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-04-at-2.56.09e280afpm.png?w=639" alt="" class="wp-image-1529" /></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>Scrolling down through the output we see that one is a definite outlier, or as we like to say around here, an <strong><em>Irregular</em></strong>.</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":1531,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-04-at-2.55.04e280afpm.png?w=1024" alt="" class="wp-image-1531" /></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>Once more to CyberChef, this time from Hex.</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":1533,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-05-at-10.47.02e280afam.png?w=1024" alt="" class="wp-image-1533" /></figure>
<!-- /wp:image -->

<!-- wp:separator -->
<hr class="wp-block-separator has-alpha-channel-opacity" />
<!-- /wp:separator -->

<!-- wp:heading -->
<h2 class="wp-block-heading">PHP Stager</h2>
<!-- /wp:heading -->

<!-- wp:image {"id":1537,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-06-at-9.20.04e280afam.png?w=793" alt="" class="wp-image-1537" /></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>Heavily obfuscated PHP. This is going to be fun.</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":1539,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-09-at-1.49.33e280afpm.png?w=1024" alt="" class="wp-image-1539" /></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>Let's see if ChatGPT can give some insight into what's going on here.</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":1542,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-09-at-1.57.50e280afpm.png?w=856" alt="" class="wp-image-1542" /></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>After several hours of back and forth from PHP to Python to PowerShell, online IDE's, more ChatGPT, googling, and back again I was able to roughly reproduce the PHP in a Python and get it to execute.</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":1544,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/maxresdefault-209118682.jpeg?w=1024" alt="" class="wp-image-1544" /></figure>
<!-- /wp:image -->

<!-- wp:image {"id":1546,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-09-at-3.09.13e280afpm.png?w=1024" alt="" class="wp-image-1546" /></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>Looks like we're not done yet.  In the middle of the output we can see another block of Base64. What happens if we toss that into CyberChef.</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":1547,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-09-at-3.11.44e280afpm.png?w=1024" alt="" class="wp-image-1547" /></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>Great! Now we have a Perl script.  How far down does this challenge go? It's like those Matryoshka dolls from Russia. One inside another inside another.  But wait... there's something interesting in the Perl script.</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":1549,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-09-at-3.15.37e280afpm.png?w=706" alt="" class="wp-image-1549" /></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>There's a reference to UU encoding and a string. We'll copy the string and bring it over to another of my favorite decoding sites, <a href="https://www.dcode.fr/">dcode.fr</a>.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Sure enough it handles the decoding and we have our flag.</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":1551,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-07-at-8.41.29e280afam.png?w=1024" alt="" class="wp-image-1551" /></figure>
<!-- /wp:image -->

<!-- wp:separator -->
<hr class="wp-block-separator has-alpha-channel-opacity" />
<!-- /wp:separator -->

<!-- wp:heading {"level":1} -->
<h1 class="wp-block-heading" id="firstHeading">Zerion</h1>
<!-- /wp:heading -->

<!-- wp:image {"id":1554,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-05-at-10.57.45e280afam.png?w=1024" alt="" class="wp-image-1554" /></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>Yay (said no one), another crazy PHP file.</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":1555,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-09-at-3.24.43e280afpm.png?w=1024" alt="" class="wp-image-1555" /></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>Looks to be using Base64 encoding, Rot13, and some other options to obfuscate the code.  Back to school (ChatGPT) to see what's going on.</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":1557,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-09-at-3.29.17e280afpm.png?w=751" alt="" class="wp-image-1557" /></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>Let's copy the large encoded text block to CyberChef. We'll apply Rot13, then Reverse the text by Character, and finally - decrypt using Base64.</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":1559,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-03-at-9.10.02e280afam-1.png?w=1024" alt="" class="wp-image-1559" /></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>And that's our flag!</p>
<!-- /wp:paragraph -->

<!-- wp:separator -->
<hr class="wp-block-separator has-alpha-channel-opacity" />
<!-- /wp:separator -->

<!-- wp:paragraph -->
<p>Use the tag <a href="https://bakerstreetforensics.com/tag/HuntressCTF/"><strong>#HuntressCTF</strong></a> on BakerStreetForensics.com to see all related posts and solutions for the 2023 Huntress CTF.</p>
<!-- /wp:paragraph -->