<!-- wp:paragraph -->
<p>Version 6 of Magnet Axiom <a rel="noreferrer noopener" href="https://mfistaging.magnetforensics.com/blog/magnet-axiom-cyber-6-0-yara-rules-queued-collections-dark-mode-and-more/" target="_blank">added support for YARA rules</a>. By default the installation ships with the free Open-Source YARA rules from <a rel="noreferrer noopener" href="https://www.reversinglabs.com/products/open-source-yara-rules" target="_blank">Reversing Labs</a>.  These YARA rules may be updated within Axiom periodically. In addition to the included rules, AXIOM supports adding your own YARA source folders.  </p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>If you need to update the included rules on demand, you can do so with a PowerShell script and the GitHub CLI.  The script below can be used to update the included rules, as well as other YARA sources you may be using within Axiom. </p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":798,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="https://bakerstreetforensics.com/wp-content/uploads/2022/07/yara.png?w=1024" alt="" class="wp-image-798" /></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p><strong>Prerequisites:</strong></p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul><li>Prior to running the script you'll need to install <a rel="noreferrer noopener" href="https://cli.github.com/" target="_blank">GitHub CLI</a></li><li>Once installed run <code><strong>gh auth login</strong> </code>to establish authentication with GitHub</li><li>When running the script you will need to run as an Administrator in order for the file-copy to ~\ProgramFiles to be successful</li></ul>
<!-- /wp:list -->

<!-- wp:heading {"level":3} -->
<h3>Set the working directory to the local git repository for the YARA rules</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>     <code>Set-Location C:\GitHub\reversinglabs-yara-rules\</code></p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3>Sync the repository; requires github CLI https://cli.github.com/</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>     <code>gh repo sync</code></p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3>Create local archive directory</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>     <code>mkdir C:\Archives -Force</code></p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3>Backup the existing YARA rules in Axiom</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>     <code>Get-ChildItem -Path "C:\Program Files\Magnet Forensics\Magnet AXIOM\YARA" | Compress-Archive -DestinationPath C:\Archives\AxiomYARA.zip</code></p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3>Variable for date/time</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>     <code>$timestamp = Get-Date -Format o | ForEach-Object { $_ -replace ":", "." }</code></p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3>Set the working directory to the Archives location</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>     <code>Set-Location "C:\Archives"</code></p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3>Rename the archive with timestamp</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>     <code>Get-ChildItem -Filter '<em>AxiomYARA</em>' -Recurse | Rename-Item -NewName {$_.name -replace 'AxiomYARA', $timestamp }</code></p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3>Copy new YARA rules to Axiom</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>     <code>robocopy /s C:\GitHub\reversinglabs-yara-rules\yara "C:\Program Files\Magnet Forensics\Magnet AXIOM\YARA\ReversingLabs"</code></p>
<!-- /wp:paragraph -->

<!-- wp:separator -->
<hr class="wp-block-separator has-alpha-channel-opacity" />
<!-- /wp:separator -->

<!-- wp:heading {"level":3} -->
<h3><strong>Now let's run it all together in a single script:</strong></h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p><code>Set-Location C:\GitHub\reversinglabs-yara-rules\<br>gh repo sync<br>mkdir C:\Archives -Force<br>Get-ChildItem -Path "C:\Program Files\Magnet Forensics\Magnet AXIOM\YARA" | Compress-Archive -DestinationPath C:\Archives\AxiomYARA.zip<br>$timestamp = Get-Date -Format o | ForEach-Object { $_ -replace ":", "." }<br>Set-Location "C:\Archives"<br>Get-ChildItem -Filter '<em>AxiomYARA</em>' -Recurse | Rename-Item -NewName {$_.name -replace 'AxiomYARA', $timestamp }<br>robocopy /s C:\GitHub\reversinglabs-yara-rules\yara "C:\Program Files\Magnet Forensics\Magnet AXIOM\YARA\ReversingLabs"</code></p>
<!-- /wp:paragraph -->

<!-- wp:separator -->
<hr class="wp-block-separator has-alpha-channel-opacity" />
<!-- /wp:separator -->

<!-- wp:paragraph -->
<p>That's all there is to it.  If you've got multiple repositories to sync, just add lines to <em>cd </em>(Set-Location) into those directories and repeat the <code>gh repo sync </code>command.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Feel free to copy the code above, or you can download directly from my <a href="https://github.com/dwmetz/Axiom-PowerShell/blob/main/AX-YaraSync.ps1" target="_blank" rel="noreferrer noopener">GitHub</a>.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Are you utilizing YARA rules within AXIOM? If so, leave a comment on what are some that you've found useful.</p>
<!-- /wp:paragraph -->