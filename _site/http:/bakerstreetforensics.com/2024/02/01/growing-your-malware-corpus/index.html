<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Growing Your Malware Corpus | Baker Street Forensics</title>
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="Growing Your Malware Corpus" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="None" />
<meta property="og:description" content="None" />
<link rel="canonical" href="http://localhost:4000/http:/bakerstreetforensics.com/2024/02/01/growing-your-malware-corpus/" />
<meta property="og:url" content="http://localhost:4000/http:/bakerstreetforensics.com/2024/02/01/growing-your-malware-corpus/" />
<meta property="og:site_name" content="Baker Street Forensics" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-02-01T11:53:45-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Growing Your Malware Corpus" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-02-01T11:53:45-05:00","datePublished":"2024-02-01T11:53:45-05:00","description":"None","headline":"Growing Your Malware Corpus","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/http:/bakerstreetforensics.com/2024/02/01/growing-your-malware-corpus/"},"url":"http://localhost:4000/http:/bakerstreetforensics.com/2024/02/01/growing-your-malware-corpus/"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Baker Street Forensics" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Baker Street Forensics</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/http:/bakerstreetforensics.com/resources/">Links &amp; Resources</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Growing Your Malware Corpus</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2024-02-01T11:53:45-05:00" itemprop="datePublished">Feb 1, 2024
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>If you’re writing YARA rules or doing other kinds of detection engineering, you’ll want to have a test bed that you can run your rules against.  This is known as a corpus. For your corpus you’ll want to have both <em>Goodware</em> (known good operating system files), as well as a library of malware files.</p>

<p>One source to get a lot of malware samples is from <a href="https://vx-underground.org/">VX-Underground</a>.  What I really appreciate about VX-Underground is that in addition to providing lots of malware samples, they also produce an <a href="https://vx-underground.org/APTs/Yearly%20Archives">annual archive</a> of samples and papers. You can download a whole year’s worth of samples and papers, from 2010 to 2023.</p>

<h2 id="pandoras-box">Pandora’s Box</h2>

<p>Just to understand the structure here, I have a USB device called “Pandora.” On the root of the drive is a folder called “APT”, and within that is a “Samples” directory. Inside the samples directory is the .7z download for 2023 from VX-Underground. There’s also a python script… we’ll get to that soon enough.</p>

<p><img src="https://bakerstreetforensics.com/wp-content/uploads/2024/02/start-tree.png?w=990" alt="" /></p>

<p>The first thing we’ll need to do is unzip the download with <em>the usual password</em>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>7zz x 2023.7z
</code></pre></div></div>

<p><img src="https://bakerstreetforensics.com/wp-content/uploads/2024/02/initial-extraction.png?w=1014" alt="" /> <img src="https://bakerstreetforensics.com/wp-content/uploads/2024/02/extract-dl.png?w=1015" alt="" /></p>

<p>Once the initial extraction is complete you can delete the original 2023.7z archive.</p>

<p>Within the archive for each year, there is a directory for the sample, with sub-directories of ‘Samples’ and ‘Papers.’ Every one of the samples is also password protected zip file.</p>

<p><img src="https://bakerstreetforensics.com/wp-content/uploads/2024/02/pre-script.png?w=1024" alt="" /></p>

<p>This makes sense from a safety perspective, but it makes it impossible to scan against all the files at once.</p>

<p><img src="https://bakerstreetforensics.com/wp-content/uploads/2024/02/cook.png?w=640" alt="" /></p>

<h2 id="python-to-the-rescue">Python to the Rescue</h2>

<p>We can utilize a Python script to recursively go through the contents of our malware folder and unzip all the password protected files, while keeping those files in their original directories.</p>

<p>You may have noticed in the first screenshot that I have a script called <strong>ExtractSamples.py</strong> in my APT directory.</p>

<p><img src="https://bakerstreetforensics.com/wp-content/uploads/2024/02/start-tree.png?w=990" alt="" /></p>

<p>We will use this for the recursive password protected extractions.</p>

<p><img src="https://bakerstreetforensics.com/wp-content/uploads/2024/02/python.png?w=468" alt="" /></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Python ExtractSamples.py
</code></pre></div></div>

<p><img src="https://bakerstreetforensics.com/wp-content/uploads/2024/02/extraction-complete.png?w=1024" alt="" /></p>

<p>A flurry of code goes by, and you congratulate yourself on you Python prowess. Now if we look again at our contents, we’ve got the extracted sample and the original zip file. </p>

<p><img src="https://bakerstreetforensics.com/wp-content/uploads/2024/02/tree-with-7z.png?w=1024" alt="" /></p>

<p>Let’s get rid of all the zip files as we don’t need them cluttering up the corpus.</p>

<p>We can start by running a find command to identify all the 7zip files.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>find . -type f -name '*.7z' -print
</code></pre></div></div>

<p><img src="https://bakerstreetforensics.com/wp-content/uploads/2024/02/find-2.png?w=1024" alt="" /></p>

<p>After you’ve checked the output and verified the command above is <strong>only grabbing the 7z files you want to delete</strong> , we can update the command to delete the found files.</p>

<p><img src="https://bakerstreetforensics.com/wp-content/uploads/2024/02/delete-7zs.png?w=923" alt="" /></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>find . -type f -name '*.7z' -delete  
</code></pre></div></div>

<p>One more a directory listing to verify:</p>

<p><img src="https://bakerstreetforensics.com/wp-content/uploads/2024/02/tree-end.png?w=1024" alt="" /></p>

<p>Success. All the 7z files are removed and all the sample files are intact.</p>

<p>GitHub Link: <a href="https://github.com/dwmetz/Toolbox/blob/main/ExtractSamples.py">ExtractSamples.py</a></p>

<p><em>Time to go write some new detections!</em></p>

  </div><a class="u-url" href="/http:/bakerstreetforensics.com/2024/02/01/growing-your-malware-corpus/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Baker Street Forensics</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Baker Street Forensics</li><li><a class="u-email" href="mailto:dwmetz@gmail.com">dwmetz@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/dwmetz"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">dwmetz</span></a></li><li><a href="https://www.twitter.com/dwmetz"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">dwmetz</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Where Irregulars Are Part Of The Game.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
