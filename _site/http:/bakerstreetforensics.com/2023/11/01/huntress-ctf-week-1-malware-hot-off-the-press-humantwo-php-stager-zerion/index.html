<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Huntress CTF: Week 1 - Malware: Hot Off The Press, HumanTwo, PHP Stager &amp; Zerion | BakerStreetForensics</title>
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="Huntress CTF: Week 1 - Malware: Hot Off The Press, HumanTwo, PHP Stager &amp; Zerion" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="None" />
<meta property="og:description" content="None" />
<link rel="canonical" href="http://localhost:4000/http:/bakerstreetforensics.com/2023/11/01/huntress-ctf-week-1-malware-hot-off-the-press-humantwo-php-stager-zerion/" />
<meta property="og:url" content="http://localhost:4000/http:/bakerstreetforensics.com/2023/11/01/huntress-ctf-week-1-malware-hot-off-the-press-humantwo-php-stager-zerion/" />
<meta property="og:site_name" content="BakerStreetForensics" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-11-01T13:00:00-04:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Huntress CTF: Week 1 - Malware: Hot Off The Press, HumanTwo, PHP Stager &amp; Zerion" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-10-22T07:14:46-04:00","datePublished":"2023-11-01T13:00:00-04:00","description":"None","headline":"Huntress CTF: Week 1 - Malware: Hot Off The Press, HumanTwo, PHP Stager &amp; Zerion","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/http:/bakerstreetforensics.com/2023/11/01/huntress-ctf-week-1-malware-hot-off-the-press-humantwo-php-stager-zerion/"},"url":"http://localhost:4000/http:/bakerstreetforensics.com/2023/11/01/huntress-ctf-week-1-malware-hot-off-the-press-humantwo-php-stager-zerion/"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="BakerStreetForensics" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">BakerStreetForensics</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Huntress CTF: Week 1 - Malware: Hot Off The Press, HumanTwo, PHP Stager &amp;amp; Zerion</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2023-11-01T13:00:00-04:00" itemprop="datePublished">Nov 1, 2023
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h2 id="hot-off-the-press">Hot Off The Press</h2>

<p><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-09-at-12.46.34e280afpm.png?w=1024" alt="" /></p>

<p>To start with let’s see what kind of file this is.</p>

<p><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-09-at-12.48.33e280afpm.png?w=995" alt="" /></p>

<blockquote>
  <p>“<strong>UHARC</strong>  is a compression/archiving system for PC platforms, which appears to be neglected since around 2005. It achieves better compression than most other archivers, at the expense of being much slower.” </p>

  <p>http://fileformats.archiveteam.org/wiki/UHARC</p>
</blockquote>

<p>I scoured the internet looking for a copy of UHARC to download. I’m not going to link any here as many if not all may contain malware. Since this is a Windows only tool, (or Wine under Linux), we’ll open this one in a sandboxed Windows system.</p>

<p><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-09-at-12.55.17e280afpm.png?w=716" alt="" /></p>

<p>When the file extracts we are presented with hot_off_the_press.ps1.</p>

<p><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-05-at-11.00.48e280afam.png?w=1024" alt="" /></p>

<p>OMG that’s a lot of obfuscation! Let’s see if we can clean this up and make it more readable. First let’s remove all the ‘’+’’</p>

<p><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-05-at-11.02.44e280afam.png?w=1024" alt="" /></p>

<p>That’s a little bit better. There’s another obfuscation method going on where specific numbers are used to represent different letters. Originally, I tried to determine the substitution by completing terms I knew. Early ahead I saw (‘‘Sc{2}i’pt{1}loc{0}Logging’’) which to me reads like ScriptBlockLogging. So all 2’s are i’s, 1’s are B’s, and 0’s are k. I do a find/replace through the script with replacements on {0},{1}, and {2}. Now it looks like a block of Base64 in the middle block. I copy it over to CyberChef and … NADA. Something’s not right.</p>

<p>If you look closer at the code, you’ll see that each one of the strings that had a {#} substitution in it ends with “-f” followed by other letters in quotations. The first character after -f is substituted for {0}, the next for {1}, etc. So I run the same substitution pattern on the script using the correct letters for this string this time.</p>

<p>Replace the {0} with L.</p>

<p><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-05-at-11.05.52e280afam.png?w=1024" alt="" /></p>

<p>Replace the {1} with E.</p>

<p><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-05-at-11.06.25e280afam.png?w=1024" alt="" /></p>

<p>Now we’ve got a nice clean block of Base64.</p>

<p><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-05-at-11.08.03e280afam.png?w=1024" alt="" /></p>

<p>Bring that over to CyberChef for decoding and:</p>

<p><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-05-at-11.09.22e280afam.png?w=1024" alt="" /></p>

<p>We’ve got a script within the script.</p>

<p>If you scroll down in the output, you’ll see that there’s something else encoded as well.</p>

<p><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-05-at-11.10.07e280afam.png?w=939" alt="" /></p>

<p>We’ll run that through CyberChef.</p>

<p><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-05-at-11.10.55e280afam.png?w=1024" alt="" /></p>

<p>Interesting we have an encoded_flag. Let’s add URL decode to the recipe.</p>

<p><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-05-at-11.11.25e280afam.png?w=1024" alt="" /></p>

<hr />

<h2 id="humantwo">HumanTwo</h2>

<p><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-05-at-11.21.25e280afam.png?w=1024" alt="" /></p>

<p>There were 1,000 files in the zip container. Easy comparison options like file size, modification date etc. don’t help as they are the same for all the files. It’s something in the content that has to be different. How the ‘f’ am I going to find the outlier in 1,000 files?! <a href="https://meldmerge.org">Meld</a> and diff are two options coming up in the Discord. I install Meld, which is really a gui for diff, and start getting a feel for it. You can compare files or directories. If doing files you could do a 3 way comparison between 3 files. But not 1000. As I was looking through the files with Meld it struck me that all of the file contents we also the same with the exception of one line.</p>

<p><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-09-at-1.34.18e280afpm.png?w=1024" alt="" /></p>

<p>Let’s run through all the files with the_silver_searcher and isolate on <strong>String.Equals</strong></p>

<p><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-04-at-2.56.09e280afpm.png?w=639" alt="" /></p>

<p>Scrolling down through the output we see that one is a definite outlier, or as we like to say around here, an <strong><em>Irregular</em></strong>.</p>

<p><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-04-at-2.55.04e280afpm.png?w=1024" alt="" /></p>

<p>Once more to CyberChef, this time from Hex.</p>

<p><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-05-at-10.47.02e280afam.png?w=1024" alt="" /></p>

<hr />

<h2 id="php-stager">PHP Stager</h2>

<p><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-06-at-9.20.04e280afam.png?w=793" alt="" /></p>

<p>Heavily obfuscated PHP. This is going to be fun.</p>

<p><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-09-at-1.49.33e280afpm.png?w=1024" alt="" /></p>

<p>Let’s see if ChatGPT can give some insight into what’s going on here.</p>

<p><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-09-at-1.57.50e280afpm.png?w=856" alt="" /></p>

<p>After several hours of back and forth from PHP to Python to PowerShell, online IDE’s, more ChatGPT, googling, and back again I was able to roughly reproduce the PHP in a Python and get it to execute.</p>

<p><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/maxresdefault-209118682.jpeg?w=1024" alt="" /> <img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-09-at-3.09.13e280afpm.png?w=1024" alt="" /></p>

<p>Looks like we’re not done yet. In the middle of the output we can see another block of Base64. What happens if we toss that into CyberChef.</p>

<p><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-09-at-3.11.44e280afpm.png?w=1024" alt="" /></p>

<p>Great! Now we have a Perl script. How far down does this challenge go? It’s like those Matryoshka dolls from Russia. One inside another inside another. But wait… there’s something interesting in the Perl script.</p>

<p><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-09-at-3.15.37e280afpm.png?w=706" alt="" /></p>

<p>There’s a reference to UU encoding and a string. We’ll copy the string and bring it over to another of my favorite decoding sites, <a href="https://www.dcode.fr/">dcode.fr</a>.</p>

<p>Sure enough it handles the decoding and we have our flag.</p>

<p><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-07-at-8.41.29e280afam.png?w=1024" alt="" /></p>

<hr />

<h1 id="zerion">Zerion</h1>

<p><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-05-at-10.57.45e280afam.png?w=1024" alt="" /></p>

<p>Yay (said no one), another crazy PHP file.</p>

<p><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-09-at-3.24.43e280afpm.png?w=1024" alt="" /></p>

<p>Looks to be using Base64 encoding, Rot13, and some other options to obfuscate the code. Back to school (ChatGPT) to see what’s going on.</p>

<p><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-09-at-3.29.17e280afpm.png?w=751" alt="" /></p>

<p>Let’s copy the large encoded text block to CyberChef. We’ll apply Rot13, then Reverse the text by Character, and finally - decrypt using Base64.</p>

<p><img src="https://bakerstreetforensics.com/wp-content/uploads/2023/10/screenshot-2023-10-03-at-9.10.02e280afam-1.png?w=1024" alt="" /></p>

<p>And that’s our flag!</p>

<hr />

<p>Use the tag <a href="https://bakerstreetforensics.com/tag/HuntressCTF/"><strong>#HuntressCTF</strong></a> on BakerStreetForensics.com to see all related posts and solutions for the 2023 Huntress CTF.</p>

  </div><a class="u-url" href="/http:/bakerstreetforensics.com/2023/11/01/huntress-ctf-week-1-malware-hot-off-the-press-humantwo-php-stager-zerion/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">BakerStreetForensics</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">BakerStreetForensics</li><li><a class="u-email" href="mailto:dwmetz@gmail.com">dwmetz@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/dwmetz"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">dwmetz</span></a></li><li><a href="https://www.twitter.com/dwmetz"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">dwmetz</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Where Irregulars Are Part of the Game</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
